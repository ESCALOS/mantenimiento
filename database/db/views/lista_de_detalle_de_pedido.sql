CREATE VIEW lista_de_detalle_de_pedido AS
SELECT dsp.id,sp.solicitante,sp.implemento_id,i.centro_de_costo_id,sp.estado,sp.validado_por,sp.fecha_de_pedido_id AS fecha_de_pedido,a.codigo,a.articulo,a.tipo,u.unidad_de_medida,u.unidad_de_medida,dsp.cantidad_solicitada,dsp.cantidad_validada,dsp.precio as precio,IFNULL(so.cantidad,0) as stock,IFNULL(ss.cantidad,0) as almacen,i.sede_id FROM `detalle_de_solicitud_de_pedidos` dsp INNER JOIN solicitud_de_pedidos sp ON sp.id = dsp.solicitud_de_pedido_id INNER JOIN articulos a ON a.id = dsp.articulo_id INNER JOIN unidad_de_medidas u ON u.id = a.unidad_de_medida_id INNER JOIN implementos i ON i.id = sp.implemento_id LEFT JOIN stock_operarios so ON ((so.user_id = sp.solicitante) AND (so.articulo_id = dsp.articulo_id)) LEFT JOIN stock_sedes ss ON((ss.articulo_id = dsp.articulo_id) AND (ss.sede_id = i.sede_id));
